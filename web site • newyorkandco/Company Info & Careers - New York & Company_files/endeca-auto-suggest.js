(function(d){var a=function(f,g,h){if(f!=null&&g!=null&&f.attributes!=null&&f.attributes[g]!=null){return f.attributes[g][0]}return(typeof(h)==="undefined"?null:h)};var e=function(){var f=window.location.pathname;var g=null;if(f.endsWith("search")){g=f.split("/search")[0]}else{if(f.endsWith("browse")){g=f.split("/browse")[0]}else{if(f.endsWith("browse/")){g=f.split("browse/")[0]}else{if(f.endsWith("search/")){g=f.split("search/")[0]}else{g=f}}}}return g};String.prototype.endsWith=function(f){var g=this.length-f.length;return g>=0&&this.lastIndexOf(f)===g};var c=0;d("#atg_store_searchInput").live("keypress",function(g){var f=(g.keyCode?g.keyCode:g.which);if((f!=37)&&(f!=38)&&(f!=39)&&(f!=40)&&(f!=13)){d(".dimSearchSuggContainer").html("")}});d(document).keypress(function(f){});d(".quick_order_search").find(".dimResult a").live("click",function(){var f=d(this).find(".ProductDetails").text();d(quicksearchlocation).val(f);d(".quick_order_search").hide()});d.EndecaSearchSuggestor=function(h,g){this._active=true;this._options=g;this._lastValue="";this._element=h;this._container=d('<div class="'+this._options.containerClass+'"></>');this._timeOutId;this._hideTimeOutId;this._selectedIndex=-1;var f=this;d("body").append(this._container);h.keydown(function(i){console.log("e.keyCode:"+i.keyCode);switch(i.keyCode){case 38:if(f._active){f.moveToPrev()}else{f.show()}break;case 40:if(f._active){f.moveToNext();i.preventDefault()}else{f.show()}break;case 9:f.hide();break;case 13:if(f._active&&f._selectedIndex!=-1){i.preventDefault();f.selectItem();return false}b(i);break;case 27:if(f._active){f.hide()}break;default:console.log("handleRequest");f.handleRequest()}});h.blur(function(i){var j=function(){f.hide()};f._hideTimeOutId=setTimeout(j,200)})};function b(g){g.preventDefault();var f=d("input#searchText").val().replace(/[</>>&%]/g,"");var h=d("#applicationPath").val()+"/search/?Dy=1&Nty=1&Ntp=1&Ntt="+f;d.post(d("#applicationPath").val()+"/cartridges/SearchBox/includes/resultRedirection.jsp?Dy=1&Ntp=1&Nty=1&Ntt="+f,{searchTerm:f},function(i){h=d("#applicationPath").val()+i.processedURI;window.location=h})}d.EndecaSearchSuggestor.prototype.moveToPrev=function(){if(this._selectedIndex==-1){this._selectedIndex=0}else{if(this._selectedIndex==0){return}this._selectedIndex--}d(".dimResult").removeClass("selected");d(d(".dimResult").get(this._selectedIndex)).addClass("selected");if(this._selectedIndex<=4){d(".dimSearchSuggContainer").scrollTop(d(".dimSearchSuggContainer").scrollTop()-60)}};d.EndecaSearchSuggestor.prototype.moveToNext=function(){if(this._selectedIndex==-1){this._selectedIndex=0}else{if(this._selectedIndex==d(".dimResult").size()-1){return}this._selectedIndex++}d(".dimResult").removeClass("selected");d(d(".dimResult").get(this._selectedIndex)).addClass("selected");if(this._selectedIndex>=5){d(".dimSearchSuggContainer").scrollTop(d(".dimSearchSuggContainer").scrollTop()+60)}};d.EndecaSearchSuggestor.prototype.selectItem=function(){if(this._selectedIndex==-1){return}var h=d("#searchText").val();var g=d("a",d("#dim_serch_cont").get(this._selectedIndex)).attr("href");var f=g.includes("/");if(f==false){g="search/?Ntp=1&Nty=1&Dy=1&Ntt="+h;document.location.href=g}else{document.location.href=g}};d.EndecaSearchSuggestor.prototype.hide=function(){this._container.hide();this._active=false};d.EndecaSearchSuggestor.prototype.show=function(){if(this._container.is(":hidden")){this.setPosition();this._container.show();this._active=true;this._selectedIndex=-1}};d.EndecaSearchSuggestor.prototype.handleRequest=function(){var f=this;var g=function(){var j=d.trim(f._element.val());var h=f._element.val();var i=h.length!=f._lastValue.length&&f._lastValue===d.trim(h)?true:false;if(j!=f._lastValue||i){d("#dim_serch_cont").html("");d("#dim_serch_cont").hide();if(j.length>=f._options.minAutoSuggestInputLength){console.log("requestData");f.requestData()}else{f.hide();d("#dim_serch_cont").html("")}}f._lastValue=j};if(this._timeOutId){clearTimeout(this._timeOutId)}this._timeOutId=setTimeout(g,this._options.delay)};d.EndecaSearchSuggestor.prototype.requestData=function(){d("#dim_serch_cont").html("");var g=this;var f=d.ajax({url:g.composeUrl(),dataType:"json",async:true,success:function(h){console.log("data:"+h);d("#dim_serch_cont").html("");g.showSearchResult(h)}})};d.EndecaSearchSuggestor.prototype.composeUrl=function(){var g=this._options.autoSuggestServiceUrl;var f=d.trim(this._element.val());if(g.indexOf("?")==-1){g+="?"}else{g+="&"}g+="Dy=1&collection="+this._options.collection+"&Ntk=AutoSuggest&Ntt="+f+"*";g+="&Ntx=mode+matchallpartial";return g};d.EndecaSearchSuggestor.prototype.showSearchResult=function(g){var f=this.processSearchResult(g);console.log("htmlResult:"+f);if(f!=null){d("#dim_serch_cont").show()}else{d("#dim_serch_cont").hide()}};d.EndecaSearchSuggestor.prototype.processSearchResult=function(x){var h=null;var t=null;jQuery.each(x,function(j,y){console.log("name: "+j+",value: "+y)});var o=x.contents[0].autoSuggest;if(o==null||o.length==0){return null}var q=null;var k="";var f=0;var v=null;var w=5;for(var p=0;p<o.length;p++){var n=o[p];if(n["@type"]=="RecordSearchAutoSuggestItem"){var m=null;var l=this;var i=null;var u=e();t=n;if(t!=null&&t.records!=null&&t.records.length>0){var g=n["@type"];i=d("<div/>").addClass(g);if(t.title){}var r="";v=t.records.length;if(t.records.length>t.defaultRecsPerPage){v=t.defaultRecsPerPage}w=t.defaultRecsPerPage;d.each(t.records,function(F,D){f=F;if(F<v){if(u.endsWith("/")){m=D.detailsAction.contentPath.split("/")[1]}else{m=D.detailsAction.contentPath}var C=u+m+D.detailsAction.recordState;var B=d("<a class='AutoSuggestRecord clearfix'/>").attr("href",C).appendTo(i);if(typeof(l._options.select)==="function"){B.click(function(N){N.preventDefault();l._options.select.call(l,l._element,D)})}var K=d("<div class='AutoSuggestRecordInfo'/>").appendTo(B);var J=a(D,"product.displayName","");if(r===J){}else{r=J;var I=a(D,"product.repositoryId","");var G=a(D,"product.CategoryId","");K.append(d("<div class='ProductName'/>").html(a(D,"product.displayName","")));var E=a(D,"product.productCode","");var L=a(D,"currNavState","");d("<div class='ProductDetails'/>").text(E).appendTo(K);var A=J.replace("&","+");var y=J.replace(/[^A-Za-z0-9+?%)(/\]]/g,"-");y=y.toLowerCase();y=y.replace(/[-]{2,}/g,"-");var H=d("#applicationPath").val()+"/search/?Dy=1&Nty=1&Ntp=1&Ntk=product.displayName&Ntt="+A;A=A.replace("'","");var z=d("#searchText").val();var M=('<a href="/'+y+"/A-"+I+"/?search=true&searchTerm="+z+"&currNavState="+L+'">'+J+"</a>");var j=d("#dim_serch_cont").attr("id");k+=M}}})}}if(n["@type"]=="DimensionSearchAutoSuggestItem"){h=n;if(h!=null){q=this.generateHtmlContent(h)}}}if(k!=""){d("#dim_serch_cont").append(k)}if(q!=null&&q!=""){if(v!=null){if(v<=w){var s=w-v;d.each(d(q).find("a"),function(z,j){if(z<s){var y=d("<p></p>").append(d(j));d("#dim_serch_cont").append(y)}})}}else{d("#dim_serch_cont").append(q)}}d("#dim_serch_cont").show();if(q!=""||k!=""){return q+k}return null};d.EndecaSearchSuggestor.prototype.generateHtmlContent=function(k){var v=null;var y=d("#searchText").val();if(k!=null&&k.dimensionSearchGroups!=null&&k.dimensionSearchGroups.length>0){v=d("<p></p>");if(k.title&&d.trim(k.title)!=""){}var u=k.dimensionSearchGroups;var w="";for(var t=0;t<u.length;t++){var B=u[t];var g=B.displayName;for(var q=0;q<B.dimensionSearchValues.length;q++){var l=B.dimensionSearchValues[q];var p=l.navigationState;var x=d("#topLevelDimvals").val();x=x.slice(1,x.length-1).split(",");var s=false;for(var t=0;t<x.length;t++){if(d.trim(x[t])===p.split("N-")[1]){s=true;console.log("dimvalId--"+x[t])}}if(s){continue}if(l.label!="Commerce Root"){var m=l.label}var f=l.ancestors;var A="";if(f!=null&&f.length>0){if(w.indexOf(l.properties["category.repositoryId"])>-1){continue}w+=l.properties["category.repositoryId"]+"-";for(var o=f.length-1;o>0;o--){if(o>1){A+=f[o].label+" In "}else{A+=f[o].label}}if(k.displayImage){var z="";var h=l.count==null?"":"&nbsp;("+l.count+")";if(d.trim(l.properties.img_url_thumbnail)!=""){z=l.properties.img_url_thumbnail}else{z=this._options.defaultImage}if(f.length>1){if(p.split("/look/").length===2){var r=p.split("N-")[1];r=r.split("?_=")[0];r="'look/N-"+r+"'";v.append('<a href="javascript:void(0);" onclick="openLook('+r+')">'+this.highlightMatched(m)+"</a>"+h)}else{v.append('<a href="'+this._options.searchUrl+p+"?searchTerm="+y+'">'+this.highlightMatched(m)+"</a>"+h)}}else{if(!s){v.append('<a href="'+this._options.searchUrl+p+"?searchTerm="+y+'">'+this.highlightMatched(m)+A+"</a>"+h)}}}else{if(f.length>1){v.append('<a href="'+this._options.searchUrl+p+"?searchTerm="+y+'">'+this.highlightMatched(m)+"</a>"+h)}else{if(!s){v.append('<a href="'+this._options.searchUrl+p+"?searchTerm="+y+'">'+this.highlightMatched(m)+A+"</a>"+h)}}}}}}}if(d(v).find("a")===undefined||d(v).find("a").length==0){v=""}return v};d.EndecaSearchSuggestor.prototype.highlightMatched=function(k){var j=d.trim(this._element.val()).toLowerCase();var g=k.toLowerCase();if(g.indexOf(j)!=-1){var f=g.indexOf(j);var h=k.substring(0,f);var i=k.substring(f+j.length);j=k.substr(f,j.length);g=h+"<span>"+j+"</span>"+i}return g};d.EndecaSearchSuggestor.prototype.bindEventHandler=function(){var f=this;d(".dimResult",this._container).mouseover(function(g){d(".dimResult",f._container).removeClass("selected");d(this).addClass("selected");f._selectedIndex=d(".dimResult",f._container).index(d(this))});d(".dimResult",this._container).click(function(g){f.selectItem()});d("a",d(".dimResult",this._container)).click(function(g){g.preventDefault();f.selectItem()});d(".dimRoots",this._container).click(function(){clearTimeout(f._hideTimeOutId);f._element.focus()})};d.EndecaSearchSuggestor.prototype.setPosition=function(){var f=this._element.offset();this._container.css({top:f.top+this._element.outerHeight(),left:f.left,width:this._element.width()})};d.fn.endecaSearchSuggest=function(f){var g=d.extend({},d.fn.endecaSearchSuggest.defaults,f);this.each(function(){var h=d(this);new d.EndecaSearchSuggestor(h,g)})};d.fn.endecaSearchSuggest.defaults={minAutoSuggestInputLength:3,displayImage:false,delay:250,autoSuggestServiceUrl:"",collection:"",searchUrl:"",containerClass:"dimSearchSuggContainer",defaultImage:"no_image.gif"};d("#searchText").endecaSearchSuggest({minAutoSuggestInputLength:3,collection:"/content/NYCO/SearchSuggestion",autoSuggestServiceUrl:"/global/typeAhead.jsp",searchUrl:"",containerClass:"dimSearchSuggContainer",defaultImage:'<c:url value="/images/no_image_auto_suggest.gif"/>'})})(jQuery);